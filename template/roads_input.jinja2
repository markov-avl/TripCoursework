<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .basis-66-minus-1rem {
            flex-basis: calc((100% / 3 * 2) - 1rem);
        }

        .basis-33-minus-1rem {
            flex-basis: calc((100% / 3) - 1rem);
        }

        table {
            text-align: center;
        }
    </style>
    <title>Редактор дорог</title>
</head>
<body>

<header>
    <nav class="flex w-full bg-blue-600">
        <h2 class="p-3 font-semibold text-slate-900 text-white mr-5 ml-5">Tripper</h2>
        <a href="#" class="p-3 hover:bg-blue-500 text-white">Редактро знаний</a>
        <a href="#" class="p-3 hover:bg-blue-500 text-white">Редактор данных</a>
        <a href="#" class="p-3 hover:bg-blue-500 text-white">Редактор задач</a>
    </nav>
</header>

<div class="flex">
    <div class="p-10 w-1/2 box-border">
        <form action="" class="flex flex-wrap gap-4">
            <h2 class="basis-full">Создание точки</h2>
            <input class="focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none text-sm
             leading-6 text-slate-900 placeholder-slate-400 rounded-md py-2 pl-4 ring-1 ring-slate-200 shadow-sm grow shrink basis-33-minus-1rem"
                   type="number" placeholder="Широта">
            <input class="focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none text-sm
             leading-6 text-slate-900 placeholder-slate-400 rounded-md py-2 pl-4 ring-1 ring-slate-200 shadow-sm grow shrink basis-33-minus-1rem"
                   type="number" placeholder="Долгота">
            <button type="submit" class="px-6 py-2 bg-green-500 rounded-md text-white">Создать точку</button>
        </form>
        <form action="" class="flex flex-wrap gap-4 mt-4">
            <h2 class="basis-full">Создание дороги</h2>
            <input class="focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none text-sm
             leading-6 text-slate-900 placeholder-slate-400 rounded-md py-2 pl-4 ring-1 ring-slate-200 shadow-sm grow shrink basis-33-minus-1rem"
                   type="number" placeholder="Id точки начала дороги">
            <input class="focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none w-1/3 text-sm
             leading-6 text-slate-900 placeholder-slate-400 rounded-md py-2 pl-4 ring-1 ring-slate-200 shadow-sm grow shrink basis-33-minus-1rem"
                   type="number" placeholder="Id точки конца дороги">
            <button type="submit" class="px-6 py-2 bg-green-500 rounded-md text-white">Создать дорогу</button>
        </form>
        <div class="">
            <table class="mt-4 w-full border-collapse">
                <caption class="text-xl font-medium">Дороги</caption>
                <tr class="border-b">
                    <th>№</th>
                    <th>Id точки начала дороги</th>
                    <th>Id точки конца дороги</th>
                    <th></th>
                </tr>
                {% for road in roads %}
                    {% set index = roads.index(road) %}
                    <tr class="border-b py-4">
                        <td id="number-{{ index }}">{{ index + 1 }}</td>
                        <td contenteditable="true" id="road-start-{{ index }}">{{ road.point_0_id }}</td>
                        <td contenteditable="true" id="road-end-{{ index }}">{{ road.point_1_id }}</td>
                        <td>
                            <button id="btn-{{ index }}"
                                    class="px-6 py-2 bg-yellow-500 rounded-md text-white"
                                    onclick="fetchPost(this)"
                            >Редактировать
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <div class="w-1/2 fixed relative">
        <img class="" src="{{ map_path }}" alt=""/>
    </div>
</div>

<script>
    const fetchPost = async (e) => {
        const idNumber = e.id.split('-').at(-1)
        const roadStartIdElement = document.getElementById('road-start-' + idNumber)
        const roadEndIdElement = document.getElementById('road-end-' + idNumber)

        const road = {
            id: +idNumber,
            point_0_id: +roadStartIdElement.innerText,
            point_1_id: +roadEndIdElement.innerText
        }

        let response = await fetch('url', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            },
            body: JSON.stringify(road)
        })

        let result = await response.json()
        console.log(result)
        window.location.reload()
    }
</script>
</body>
</html>